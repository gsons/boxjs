(()=>{var t={182:()=>{},969:t=>{"use strict";t.exports={}}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var s=e[o]={exports:{}};return t[o](s,s.exports,n),s.exports}(()=>{"use strict";var t,e,o=(t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)});!function(t){t[t.BASE=0]="BASE",t[t.HTTP=1]="HTTP",t[t.SYS=2]="SYS",t[t.OTHER=3]="OTHER"}(e||(e={}));const r=function(t){function n(o,r){void 0===r&&(r=e.BASE);var s=t.call(this,o)||this;return s.name="baseErr",s.code=r,s.stack=(new Error).stack,Object.setPrototypeOf(s,n.prototype),s}return o(n,t),n}(Error);var s,i=function(t,e,n,o){return new(n||(n=Promise))((function(r,s){function i(t){try{u(o.next(t))}catch(t){s(t)}}function a(t){try{u(o.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}u((o=o.apply(t,e||[])).next())}))},a=function(t,e){var n,o,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}},u=function(t,e,n){if(n||2===arguments.length)for(var o,r=0,s=e.length;r<s;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))};!function(t){t.Surge="Surge",t.Loon="Loon",t.QuanX="QuanX",t.Shadowrocket="Shadowrocket",t.Node="Node"}(s||(s={}));const c=function(){function t(t,e){this.isMute=!1,this.response={},this.name=t,this.namespace=e,this.logMsg=[],this.logSeparator="",this.startTime=(new Date).getTime(),this.log("ğŸ””".concat(this.name,", å¼€å§‹!\n")),this.initEnv(),this.log("å½“å‰ç¯å¢ƒä¸ºï¼š"+this.env);var o=this.getStore("mute",!0);this.isMute="true"==o,n(969),n(182)}return t.prototype.run=function(){var t=this;this.doAction().catch((function(n){n instanceof r?(t.log(""+n.code),n.code==e.BASE?t.msg(t.name,n.message,""):n.code==e.HTTP?Math.random()>.8?t.msg(t.name,"ç½‘ç»œå¼‚å¸¸ï¼š"+n.message,""):t.log(t.name,"ç½‘ç»œå¼‚å¸¸Logï¼š"+n.message,""):t.log(n.message,"")):t.log(n),t.ajaxFail(n.message||n)})).finally((function(){t.done()}))},t.prototype.transParams=function(t){return Object.keys(t).map((function(e){return"".concat(e,"=").concat(encodeURIComponent(t[e]))})).join("&")},t.prototype.random=function(t){for(var e="",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",o=n.length,r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*o));return e},t.prototype.done=function(){var e=((new Date).getTime()-this.startTime)/1e3;if(console.log("response: "+JSON.stringify(this.response)),this.log("ğŸ””".concat(this.name,", ç»“æŸ! ğŸ•› ").concat(e," ç§’")),this.env==s.Node)process.exit(1);else{var n="\n"+this.getStore(t.APP_LOG_KEY,!0);n=n.split("\n").slice(0,1e4).join("\n"),n=this.logMsg.reverse().join("\n")+(n||""),this.setStore(t.APP_LOG_KEY,n,!0),console.log("æ³¨æ„æœ¬æ¬¡è¿è¡Œæ—¥å¿—å·²ç¼“å­˜åˆ°å˜é‡ ".concat(this.namespace+"."+t.APP_LOG_KEY)),$done(this.response)}},t.prototype.getStore=function(t,e){return void 0===e&&(e=!0),e&&(t=this.namespace+"."+t),this.env==s.Surge||this.env==s.Shadowrocket||this.env==s.Loon?$persistentStore.read(t):this.env==s.QuanX?$prefs.valueForKey(t):null},t.prototype.handelLogHttp=function(){this.log("è¿è¡Œ ã€‹ ".concat(this.name,"ç³»ç»Ÿè¿è¡Œæ—¥å¿—httpæœåŠ¡å™¨"));var e=this.getStore(t.APP_LOG_KEY,!0);e=(e=e||"").replace(/\n/g,"<br>"),this.httpResponse(e,{"Content-Type":"text/html;charset=utf-8"})},t.prototype.msg=function(t,e,n){this.log("==============ğŸ“£ç³»ç»Ÿé€šçŸ¥ğŸ“£==============\n"+t+"\n"+e+"\n"+n),this.isMute||(this.env==s.Surge||this.env==s.Shadowrocket||this.env==s.Loon?$notification.post(t,e,n):this.env==s.QuanX&&$notify(t,e,n))},t.prototype.log=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];(e=e.map((function(e){return t.date("yyyy-MM-dd HH:mm:ss")+" "+e}))).length>0&&(this.logMsg=u(u([],this.logMsg,!0),e,!0)),console.log(e.join(this.logSeparator))},t.prototype.date=function(t,e){void 0===e&&(e=null);var n=e?new Date(e):new Date,o={"M+":n.getMonth()+1,"d+":n.getDate(),"H+":n.getHours(),"m+":n.getMinutes(),"s+":n.getSeconds(),"q+":Math.floor((n.getMonth()+3)/3),S:n.getMilliseconds()};for(var r in/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(n.getFullYear()+"").substr(4-RegExp.$1.length))),o){var s=o[r];new RegExp("("+r+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?s:("00"+s).substr((""+s).length)))}return t},t.prototype.httpResponse=function(t,e){void 0===e&&(e={});var n=Object.assign({"Content-Type":"application/json; charset=utf-8","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST,GET","Access-Control-Allow-Headers":"Origin, X-Requested-With, Content-Type, Accept"},e);this.response={response:{status:200,body:"string"==typeof t?t:JSON.stringify(t),headers:n}}},t.prototype.ajaxSuccess=function(t,e){void 0===e&&(e=null);var n={time:(new Date).getTime(),datetime:this.date("yyyy-MM-dd HH:mm:ss"),code:1,msg:t,data:e};this.httpResponse(n)},t.prototype.ajaxFail=function(t,e){void 0===e&&(e=null);var n={time:(new Date).getTime(),datetime:this.date("yyyy-MM-dd HH:mm:ss"),code:0,msg:t,data:e};this.httpResponse(n)},t.prototype.send=function(t){var n=this;return new Promise((function(o,s){n.doRequest(t,(function(t,n,i){t?s(new r(t,e.HTTP)):o(n)}))}))},t.prototype.post=function(t){return i(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return t.method="post",[4,this.send(t)];case 1:return[2,e.sent()]}}))}))},t.prototype.get=function(t){return i(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return t.method="get",[4,this.send(t)];case 1:return[2,e.sent()]}}))}))},t.prototype.doRequest=function(t,e){void 0===e&&(e=function(t,e,n){});var n=t.method?t.method.toLocaleLowerCase():"post";t.body&&t.headers&&!t.headers["Content-Type"]&&(t.headers["Content-Type"]="application/x-www-form-urlencoded"),t.headers&&delete t.headers["Content-Length"],this.env==s.Surge||this.env==s.Shadowrocket||this.env==s.Loon?(this.env==s.Surge&&this.isNeedRewrite&&(t.headers=t.headers||{},Object.assign(t.headers,{"X-Surge-Skip-Scripting":!1})),$httpClient[n](t,(function(t,n,o){!t&&n&&(n.body=o,n.statusCode=n.status?n.status:n.statusCode,n.status=n.statusCode),e(t,n,o)}))):this.env==s.QuanX?(t.method=n,this.isNeedRewrite&&(t.opts=t.opts||{},Object.assign(t.opts,{hints:!1})),$task.fetch(t).then((function(t){var n=t.statusCode,o=t.statusCode,r=t.headers,s=t.body;e(null,{status:n,statusCode:o,headers:r,body:s},s)}),(function(t){return e(t&&t.error||"UndefinedError",null,null)}))):this.env==s.Node&&console.log(this.env)},t.prototype.setStore=function(t,e,n){return void 0===n&&(n=!0),n&&(t=this.namespace+"."+t),this.env==s.Surge||this.env==s.Shadowrocket||this.env==s.Loon?$persistentStore.write(e,t):this.env==s.QuanX&&$prefs.setValueForKey(e,t)},t.prototype.getLoginNum=function(){var t=this.getStore("login_num"),e=this.date("yyyyMMdd");if(t){var n=t.split("_"),o=n[0],r=n[1];return o==e&&r?Number(r):(this.setStore("login_num","".concat(e,"_0")),0)}return this.setStore("login_num","".concat(e,"_0")),0},t.prototype.incLoginNum=function(){var t=this.getLoginNum();t++;var e=this.date("yyyyMMdd");this.setStore("login_num","".concat(e,"_").concat(t))},t.prototype.initEnv=function(){"undefined"!=typeof $task?this.env=s.QuanX:"undefined"!=typeof $loon?this.env=s.Loon:"undefined"!=typeof $rocket?this.env=s.Shadowrocket:"undefined"!=typeof $httpClient&&"undefined"==typeof $loon?this.env=s.Surge:this.env=s.Node},t.APP_LOG_KEY="boxjs-log",t}();var h=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),p=function(t,e,n,o){return new(n||(n=Promise))((function(r,s){function i(t){try{u(o.next(t))}catch(t){s(t)}}function a(t){try{u(o.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,a)}u((o=o.apply(t,e||[])).next())}))},l=function(t,e){var n,o,r,s,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(i=0)),i;)try{if(n=1,o&&(r=2&a[0]?o.return:a[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,a[1])).done)return r;switch(o=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,o=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!((r=(r=i.trys).length>0&&r[r.length-1])||6!==a[0]&&2!==a[0])){i=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){i.label=a[1];break}if(6===a[0]&&i.label<r[1]){i.label=r[1],r=a;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(a);break}r[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],o=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};new(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.signurlKey="sign_url",e.signheaderKey="sign_header",e}return h(e,t),e.prototype.handelSign=function(){return p(this,void 0,void 0,(function(){var t,e,n,o,s;return l(this,(function(i){switch(i.label){case 0:return this.log("è¿è¡Œ ã€‹ ç­‹æ–—äº‘ç­¾åˆ°"),t=JSON.parse(this.getStore(this.signheaderKey,!0)),e=this.getStore(this.signurlKey,!0),n=/https?:\/\/.*?\//.exec(e)[0],o={url:"".concat(n,"user/checkin"),headers:t},this.log("Http request:"+o.url),[4,this.post(o)];case 1:s=i.sent();try{s=JSON.parse(s.body)}catch(t){throw new r("ç™»å½•çŠ¶æ€å¯èƒ½å·²ç»å¤±æ•ˆ"+t)}return this.msg(this.name,s.msg,JSON.stringify(s)),[2]}}))}))},e.prototype.handelSignCookie=function(){this.log("è¿è¡Œ ã€‹ è·å–ç­‹æ–—äº‘COOKIE"),this.setStore(this.signurlKey,$request.url,!0),this.setStore(this.signheaderKey,JSON.stringify($request.headers),!0),this.msg(this.name,"è·å–Cookie: æˆåŠŸ (ç­‹æ–—äº‘)","")},e.prototype.handelWebHttp=function(){return p(this,void 0,void 0,(function(){var t,e,n,o,s;return l(this,(function(i){switch(i.label){case 0:return this.log("è¿è¡Œ ã€‹  ç­‹æ–—äº‘ä¸ªäººä¿¡æ¯æŸ¥è¯¢httpæœåŠ¡å™¨"),t=this.getStore(this.signurlKey,!0),e=JSON.parse(this.getStore(this.signheaderKey,!0)),n={url:t,headers:e},o=null,[4,this.get(n)];case 1:s=i.sent();try{o=this.fetchJindouyun(s.body)}catch(t){throw new r("è·å–ç­‹æ–—äº‘ä¸ªäººä¿¡æ¯å¤±è´¥ï¼Œç™»å½•çŠ¶æ€å¯èƒ½å·²ç»å¤±æ•ˆ:"+t)}return this.ajaxSuccess("è·å–ç­‹æ–—äº‘ä¸ªäººä¿¡æ¯æˆåŠŸ",o),[2]}}))}))},e.prototype.doAction=function(){return p(this,void 0,void 0,(function(){var t,e,n,o,s;return l(this,(function(i){switch(i.label){case 0:return"undefined"==typeof $request||"OPTIONS"==$request.method?[3,7]:/^https?:\/\/(my\.|)somersaultcloud\.(xyz|top)\/user$/.test($request.url)?(this.handelSignCookie(),[3,6]):[3,1];case 1:return/^https?:\/\/cloud\.json/.test($request.url)?[4,this.handelWebHttp()]:[3,3];case 2:return i.sent(),[3,6];case 3:return/^https?:\/\/cloud\.log/.test($request.url)?(this.handelLogHttp(),[3,6]):[3,4];case 4:return[4,this.handelSign()];case 5:i.sent(),i.label=6;case 6:return[3,11];case 7:return"undefined"==typeof $argument||"ip"!==$argument?[3,9]:[4,this.get({url:"https://whois.pconline.com.cn/ipJson.jsp"})];case 8:t=i.sent(),e="";try{if(n=t.body.match(/\d+\.\d+\.\d+\.\d+/),e=n[0],this.log("è·å–åˆ°å½“å‰å¤–ç½‘ipåœ°å€ï¼š"+e),o=this.getStore("ip_list",!0),s=[],o&&(s=JSON.parse(o)),s.includes(e))return this.log("ipåœ°å€ï¼š"+e+"å·²ç»åŠ ç™½ï¼Œæ— éœ€åŠ ç™½ï¼"),[2];s.push(e),this.setStore("ip_list",JSON.stringify(s),!0)}catch(e){throw new r("è·å–IPå¤–ç½‘å¤±è´¥ "+e+"=>res.body"+t.body)}return e&&(this.log("å°è¯•å°†ipåœ°å€ï¼š"+e+" åŠ å…¥åˆ°ç™½åå•"),this.get({url:"http://hk-trail.somnode.top/addip.php?ip="+e}),this.get({url:"http://us-trail.somnode.top/addip.php?ip="+e}),this.get({url:"http://jp-trail.somnode.top/addip.php?ip="+e}),this.get({url:"http://sg-trail.somnode.top/addip.php?ip="+e}),this.get({url:"http://tw-trail.somnode.top/addip.php?ip="+e}),this.get({url:"http://ru-trail.somnode.top/addip.php?ip="+e}),this.get({url:"http://hk-i.somnode.top/addip.php?ip="+e}),this.get({url:"http://hk-ii.somnode.top/addip.php?ip="+e}),this.get({url:"http://hk-iii.somnode.top/addip.php?ip="+e}),this.get({url:"http://hk-d.somnode.top/addip.php?ip="+e}),this.get({url:"http://hk-e.somnode.top/addip.php?ip="+e}),this.get({url:"http://hk-f.somnode.top/addip.php?ip="+e})),[3,11];case 9:return[4,this.handelSign()];case 10:i.sent(),i.label=11;case 11:return[2]}}))}))},e.prototype.fetchJindouyun=function(t){var e=/<h4>å‰©ä½™æµé‡<\/h4>\n\s+<\/div>\n\s+<div class="card-body">\n\s+<span class="counter">(.*)?<\/span> (MB|GB|KB)/.exec(t),n=e[1],o=e[2],r=/<h4>åŒæ—¶åœ¨çº¿è®¾å¤‡æ•°<\/h4>\n\s+<\/div>\n\s+<div class="card-body">\n\s+<span class="counter">(\d+)<\/span> \/ <span class="counterup">(\d+)<\/span>/.exec(t),s={remain_flow:n+o,online:r[1],sum:r[2],used_flow:/ä»Šæ—¥å·²ç”¨: (.*?)<\/li>/.exec(t)[1],last_used_date:/ä¸Šæ¬¡ä½¿ç”¨æ—¶é—´: (.*?)<\/li>/.exec(t)[1],momey:/<h4>é’±åŒ…ä½™é¢<\/h4>\n\s+<\/div>\n\s+<div class="card-body">\n\s+Â¥\s+<span class="counter">(.*)?<\/span>/.exec(t)[1],commission:/ç´¯è®¡è·å¾—è¿”åˆ©é‡‘é¢: Â¥(.*?)<\/li>/.exec(t)[1]};return this.log("â†“ fetch Jindouyun"),this.log(JSON.stringify(s)),s},e}(c))("ç­‹æ–—äº‘","gsonhub.cloud").run()})()})();